<div class="min-h-screen flex flex-col bg-[#0d1f33] text-gray-300">
  <app-header></app-header>

  <main class="flex-grow py-16 md:py-24">
    <section class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-6xl">
      <div class="rounded-xl border border-gray-700/50 bg-slate-900/40 p-6 md:p-8">
        <div class="flex items-start justify-between gap-4">
          <div>
            <h1 class="text-3xl md:text-4xl font-bold text-white tracking-tight">
              {{ i18n.lang() === 'es' ? 'Panel administrador' : 'Administrator panel' }}
            </h1>
            <p class="mt-2 text-gray-400">
              {{ i18n.lang() === 'es' ? 'Alta de metricas y proyectos privados por usuario.' : 'Create metrics and private projects by user.' }}
            </p>
          </div>
          <button
            type="button"
            (click)="onGoPortal()"
            class="inline-flex items-center justify-center rounded-md border border-blue-500 px-4 py-2 font-semibold text-blue-300 hover:bg-blue-900/30"
          >
            {{ i18n.lang() === 'es' ? 'Volver al portal' : 'Back to portal' }}
          </button>
        </div>

        @if (checking()) {
          <p class="mt-6 text-sm text-gray-400">
            {{ i18n.lang() === 'es' ? 'Validando permisos...' : 'Validating permissions...' }}
          </p>
        } @else {
          @if (error()) {
            <p class="mt-6 rounded-md border border-red-500/40 bg-red-500/10 px-3 py-2 text-sm text-red-200">
              {{ error() }}
            </p>
          }
          @if (info()) {
            <p class="mt-6 rounded-md border border-emerald-500/40 bg-emerald-500/10 px-3 py-2 text-sm text-emerald-200">
              {{ info() }}
            </p>
          }

          @if (isAdmin()) {
            <div class="mt-8 grid grid-cols-1 lg:grid-cols-2 gap-6">
              <article class="rounded-lg border border-slate-700/60 bg-slate-800/40 p-5">
                <h2 class="text-lg font-semibold text-white">{{ i18n.lang() === 'es' ? 'Nueva metrica' : 'New metric' }}</h2>
                <form class="mt-4 space-y-3" (submit)="onCreateMetric($event, mUserId.value, mKey.value, mLabel.value, mValue.value, mCurrency.value, mTrend.value)">
                  <input #mUserId required placeholder="user_id (UUID)" class="w-full rounded-md border border-slate-600 bg-slate-900/70 px-3 py-2 text-sm text-gray-100" />
                  <input #mKey required placeholder="metric_key (ej: irr)" class="w-full rounded-md border border-slate-600 bg-slate-900/70 px-3 py-2 text-sm text-gray-100" />
                  <input #mLabel required placeholder="metric_label (ej: IRR objetivo)" class="w-full rounded-md border border-slate-600 bg-slate-900/70 px-3 py-2 text-sm text-gray-100" />
                  <input #mValue type="number" step="0.01" required placeholder="metric_value" class="w-full rounded-md border border-slate-600 bg-slate-900/70 px-3 py-2 text-sm text-gray-100" />
                  <div class="grid grid-cols-2 gap-3">
                    <input #mCurrency value="EUR" placeholder="currency" class="w-full rounded-md border border-slate-600 bg-slate-900/70 px-3 py-2 text-sm text-gray-100" />
                    <input #mTrend type="number" step="0.01" placeholder="trend_pct" class="w-full rounded-md border border-slate-600 bg-slate-900/70 px-3 py-2 text-sm text-gray-100" />
                  </div>
                  <button [disabled]="savingMetric()" type="submit" class="rounded-md bg-blue-600 px-4 py-2 font-semibold text-white hover:bg-blue-500 disabled:opacity-60">
                    {{ savingMetric() ? (i18n.lang() === 'es' ? 'Guardando...' : 'Saving...') : (i18n.lang() === 'es' ? 'Crear metrica' : 'Create metric') }}
                  </button>
                </form>
              </article>

              <article class="rounded-lg border border-slate-700/60 bg-slate-800/40 p-5">
                <h2 class="text-lg font-semibold text-white">{{ i18n.lang() === 'es' ? 'Nuevo proyecto' : 'New project' }}</h2>
                <form class="mt-4 space-y-3" (submit)="onCreateProject($event, pUserId.value, pName.value, pStatus.value, pBudget.value, pProgress.value)">
                  <input #pUserId required placeholder="user_id (UUID)" class="w-full rounded-md border border-slate-600 bg-slate-900/70 px-3 py-2 text-sm text-gray-100" />
                  <input #pName required placeholder="name" class="w-full rounded-md border border-slate-600 bg-slate-900/70 px-3 py-2 text-sm text-gray-100" />
                  <input #pStatus value="active" placeholder="status" class="w-full rounded-md border border-slate-600 bg-slate-900/70 px-3 py-2 text-sm text-gray-100" />
                  <div class="grid grid-cols-2 gap-3">
                    <input #pBudget type="number" step="0.01" placeholder="budget" class="w-full rounded-md border border-slate-600 bg-slate-900/70 px-3 py-2 text-sm text-gray-100" />
                    <input #pProgress type="number" step="0.01" placeholder="progress_pct" class="w-full rounded-md border border-slate-600 bg-slate-900/70 px-3 py-2 text-sm text-gray-100" />
                  </div>
                  <button [disabled]="savingProject()" type="submit" class="rounded-md bg-blue-600 px-4 py-2 font-semibold text-white hover:bg-blue-500 disabled:opacity-60">
                    {{ savingProject() ? (i18n.lang() === 'es' ? 'Guardando...' : 'Saving...') : (i18n.lang() === 'es' ? 'Crear proyecto' : 'Create project') }}
                  </button>
                </form>
              </article>
            </div>

            <div class="mt-10 grid grid-cols-1 lg:grid-cols-2 gap-6">
              <article class="rounded-lg border border-slate-700/60 bg-slate-800/30 p-5">
                <h3 class="text-base font-semibold text-white">{{ i18n.lang() === 'es' ? 'Metricas recientes' : 'Recent metrics' }}</h3>
                <div class="mt-3 space-y-2 text-sm">
                  @for (m of recentMetrics(); track m.user_id + m.metric_label) {
                    <div class="rounded-md border border-slate-700/60 bg-slate-900/50 p-3">
                      <p class="text-white">{{ m.metric_label }}: {{ formatMoney(m.metric_value, m.currency) }}</p>
                      <p class="text-gray-400">{{ m.user_id }}</p>
                    </div>
                  }
                </div>
              </article>

              <article class="rounded-lg border border-slate-700/60 bg-slate-800/30 p-5">
                <h3 class="text-base font-semibold text-white">{{ i18n.lang() === 'es' ? 'Proyectos recientes' : 'Recent projects' }}</h3>
                <div class="mt-3 space-y-2 text-sm">
                  @for (p of recentProjects(); track p.user_id + p.name) {
                    <div class="rounded-md border border-slate-700/60 bg-slate-900/50 p-3">
                      <p class="text-white">{{ p.name }} ({{ p.status }})</p>
                      <p class="text-gray-300">{{ formatMoney(p.budget, 'EUR') }}</p>
                      <p class="text-gray-400">{{ p.user_id }}</p>
                    </div>
                  }
                </div>
              </article>
            </div>
          }
        }
      </div>
    </section>
  </main>

  <app-footer></app-footer>
</div>
